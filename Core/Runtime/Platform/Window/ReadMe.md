# Window

## 提供功能

- 输入
- 光标
- 屏幕
- 时间

## 实现目的

窗口是整个引擎的躯体，是运动的基本。夸张点说，没有窗口就没有应用程序，甚至有操作系统直接将窗口作为自己的名称[^1]
，可想而知它的重要性非比寻常。我们需要通过窗口实现和用户的交互，并让窗口执行我们的代码，以及提供一些基本的软件环境信息。

## 设计思路

### 跨平台

窗口是操作系统提供的，不同平台有不同的窗口，为实现跨平台需求并节省工作量，此处直接借助glfw来开发。

### 输入输出

窗口是我们用于和用户通信的通道，窗口应可以接受用户输入，比如键盘，鼠标事件，并提供相应回调，让我们的程序得以处理这些用户操作。  
处理完后我们应当能将结果反馈给用户，常见的比如在屏幕上显示一行字，但这部分比较复杂，原生窗口也没有直接提供功能，所以这方面的工作要交给另一个模块处理，而窗口需要提供给这些模块一个接入点。

### 循环更新

除去输入输出时的回调，窗口还应该提供一个随时间执行进行的回调，这样我们才能让画面得以保持动态更新。窗口本身具有一个绘制事件，因为窗口的画面经常需要重绘，绝大时候该事件都会自动调用且更新频繁，但用户无操作时便会停止，我们需要手动让该事件在空闲时也能持续触发，不过glfw用不到这个，因为他的窗口事件处理是非阻塞的，和原生的Windows处理函数不一样。

### 事件回调[^2]

有多个功能块会用到相同的事件，且它们之间很可能需要相互协作，如何正确添加它们的更新事件，确保按照预期的顺序执行很重要。

#### 延迟输入输出结果

不直接在输入输出时触发回调，因为这样会导致程序执行顺序不可控。这里可以仿照其他引擎的做法，遇上输入输出时缓存结果，然后让监听者自行在统一的流程中进行使用，这样还能简化事件相关代码的实现。

#### 控制添加事件方式

- 通过头文件初始化自动注册  
  优点：自动化，对用户透明  
  缺点：可控性差，不是主流方法，无法确保支持率，会产生模块依赖
- 手动注册  
  优点：可控，安全，大部分第三方库都是通过该方式使用，不会产生依赖  
  缺点：需要手动控制，麻烦（但可以通过封装的方式对引擎使用者屏蔽）

有流程要求的事件应统一使用手动注册的方式，用开发者自行连接，小部分情况可以考虑通过头文件初始化的方式。

### 单例模式

该窗口是作为整个引擎的心脏使用，推动流程的只要一个窗口就行，所以应该作为静态类实现。

[^1]: 什么是窗口？ https://learn.microsoft.com/zh-cn/windows/win32/learnwin32/what-is-a-window-  
[^2]: Unity中的事件函数执行顺序 https://docs.unity.cn/cn/2019.4/Manual/ExecutionOrder.html