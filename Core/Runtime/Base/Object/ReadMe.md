# 物体基类

## 提供功能

- 对象管理
- 引用序列化
- 安全指针

# 实现目的

对原生C++类型进行增强以提供更多管理手段。

# 设计思路

## 安全指针

### 引用计数
Object是一个引用类型，首先和正常的引用类型一样，当没有人使用时应该被销毁，使用引用计数的方式即可获知该情况。
### 显式销毁
Object需要能被显式销毁，因此ObjectPtr就不能直接保存指针，这可能会导致野指针，所以使用ObjectID间接引用。
### 指针序列化
为统一处理，采用类型擦除的办法，推出ObjectPtrBase进行序列化，重新创建时要能正常复原到泛型指针，所以需要记录虚表信息，用于还原。

## 引用序列化

对于引用关系我们需要特殊处理，单独序列化被引用的对象，并将其关联到一个Guid，然后其他引用物体则保存该Guid而不是对象，这样多对一的引用关系就可以保存下来。反序列化时先反序列化被引用对象，然后再将引用物体用到的Guid换成该对象的指针，即可还原引用。  
考虑到一个序列化文件可能有多个物体存在，当需要引用文件内的特定物体时仅使用Guid就会不太方便。所以再外加一个随机数fileID表示文件内索引，这样{Guid,fileID}就可以完全表示一个引用，该功能用ObjectRef类实现。

### 持久化标记

如何判断一个物体是不是资源，可以接用ObjectRef判断，因为想要持久化必须拥有ObjectRef。
